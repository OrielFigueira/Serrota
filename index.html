<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Serrota - E-commerce de Produtos Digitais</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Fonte -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  >

  <!-- Opção recomendada: jsDelivr -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root {
      --page-bg: #d9e4ff;
      --shell-bg: #f3f4ff;
      --card-bg: #ffffff;
      --hero-gradient: linear-gradient(135deg, #1e3a8a, #1d4ed8);
      --text-main: #111827;
      --text-muted: #6b7280;
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --border-soft: #e5e7eb;
      --danger: #ef4444;
      --radius-lg: 18px;
      --shadow-strong: 0 22px 60px rgba(15, 23, 42, 0.35);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--page-bg);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 40px 16px;
      -webkit-font-smoothing: antialiased;
    }

    .page-shell {
      max-width: 1120px;
      width: 100%;
      background: var(--shell-bg);
      border-radius: 24px;
      box-shadow: var(--shadow-strong);
      overflow: hidden;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 32px;
      background: #ffffff;
      border-bottom: 1px solid var(--border-soft);
      font-size: 14px;
    }

    .header-left { display: flex; align-items: center; gap: 10px; }
    .logo-svg { height: 30px; width: auto; display: block; }

    .header-center {
      display: flex;
      gap: 18px;
      font-size: 13px;
      font-weight: 500;
      color: #4b5563;
    }

    .header-center button {
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 6px 12px;
      border-radius: 999px;
      transition: background 0.15s, color 0.15s;
    }

    .header-center button.active,
    .header-center button:hover {
      background: #e5edff;
      color: var(--primary-dark);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
      color: #4b5563;
    }

    .icon-btn {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #f9fafb;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.15s, box-shadow 0.15s, transform 0.1s;
      font-size: 14px;
    }

    .icon-btn:hover {
      background: #e5edff;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.12);
      transform: translateY(-1px);
    }

    .account-label {
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      font-size: 13px;
    }

    main { padding: 0 32px 32px 32px; }

    .hero {
      margin-top: 20px;
      background: var(--hero-gradient);
      border-radius: var(--radius-lg);
      padding: 32px;
      color: #ffffff;
      position: relative;
      overflow: hidden;
      min-height: 220px;
      display: flex;
      align-items: center;
    }

    .hero::after {
      content: "";
      position: absolute;
      right: -90px;
      top: -50px;
      width: 420px;
      height: 320px;
      background: radial-gradient(circle at center, rgba(96, 165, 250, 0.8), transparent 60%);
      opacity: 0.6;
    }

    .hero-content { max-width: 460px; position: relative; z-index: 1; }
    .hero-kicker { font-size: 11px; text-transform: uppercase; letter-spacing: 0.16em; color: #bfdbfe; margin-bottom: 8px; }
    .hero-title { font-size: 30px; font-weight: 700; line-height: 1.2; margin-bottom: 10px; }
    .hero-subtitle { font-size: 13px; color: #e5e7eb; line-height: 1.7; margin-bottom: 18px; }

    .hero-actions { display: flex; gap: 10px; }

    .btn-primary {
      padding: 9px 18px;
      border-radius: 999px;
      border: none;
      background: #60a5fa;
      color: #0b1120;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 12px 25px rgba(37, 99, 235, 0.55);
      transition: background 0.15s, transform 0.1s, box-shadow 0.15s;
    }

    .btn-primary:hover {
      background: #93c5fd;
      transform: translateY(-1px);
      box-shadow: 0 18px 34px rgba(37, 99, 235, 0.6);
    }

    .btn-secondary {
      padding: 9px 18px;
      border-radius: 999px;
      border: 1px solid rgba(191, 219, 254, 0.8);
      background: transparent;
      color: #e5e7eb;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.15s, color 0.15s;
    }

    .btn-secondary:hover { background: rgba(191, 219, 254, 0.14); }

    .section { margin-top: 30px; }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
    }

    .section-title { font-size: 20px; font-weight: 600; }
    .section-subtitle { font-size: 13px; color: var(--text-muted); margin-top: 4px; }

    .btn-ghost {
      padding: 7px 14px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      color: #374151;
      transition: background 0.15s;
    }

    .btn-ghost:hover { background: #e5edff; }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 16px;
    }

    .product-card {
      background: var(--card-bg);
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 12px 32px rgba(15, 23, 42, 0.12);
      display: flex;
      flex-direction: column;
      min-height: 250px;
    }

    .product-image {
      background: radial-gradient(circle at top, #e5edff, #c4d7ff);
      border-radius: 14px;
      height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
    }

    .product-image img {
      max-width: 80%;
      max-height: 80%;
      object-fit: contain;
    }

    .product-image img {
      max-width: 80%;
      max-height: 80%;
      object-fit: contain;
    }

    .product-category { font-size: 11px; text-transform: uppercase; letter-spacing: 0.16em; color: #9ca3af; }
    .product-name { font-size: 14px; font-weight: 600; margin-top: 2px; }
    .product-description { font-size: 13px; color: var(--text-muted); margin-top: 4px; }
    .product-price { font-size: 14px; font-weight: 600; color: var(--primary-dark); margin-top: 4px; }

    .product-meta-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: auto;
      margin-bottom: 8px;
      gap: 6px;
    }

    .product-badge {
      font-size: 10px;
      font-weight: 700;
      color: #b91c1c;
      background: #fee2e2;
      padding: 4px 8px;
      border-radius: 999px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .stock-label { font-size: 11px; color: #059669; margin-left: auto; }

    .btn-add-cart {
      padding: 7px 10px;
      border-radius: 999px;
      border: none;
      background: var(--primary);
      color: #ffffff;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      justify-content: center;
      transition: background 0.15s, box-shadow 0.15s, transform 0.1s;
    }

    .btn-add-cart:hover {
      background: var(--primary-dark);
      box-shadow: 0 12px 26px rgba(37, 99, 235, 0.5);
      transform: translateY(-1px);
    }

    .btn-add-cart.disabled,
    .btn-add-cart.disabled:hover {
      background: #9ca3af;
      box-shadow: none;
      cursor: not-allowed;
      transform: none;
    }

    .categories-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 16px;
    }

    .category-card {
      background: var(--card-bg);
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.1);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 140px;
      font-size: 13px;
    }

    .category-name { font-size: 15px; font-weight: 600; margin-bottom: 4px; }
    .category-description { font-size: 13px; color: var(--text-muted); margin-bottom: 10px; }
    .category-link { font-size: 13px; color: var(--primary-dark); font-weight: 500; cursor: pointer; }

    .benefits {
      margin-top: 30px;
      background: #e5edff;
      border-radius: 18px;
      padding: 22px 24px 18px 24px;
      text-align: center;
    }

    .benefits-title { font-size: 20px; font-weight: 600; margin-bottom: 5px; }
    .benefits-subtitle { font-size: 13px; color: var(--text-muted); margin-bottom: 16px; }

    .benefits-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 16px;
      text-align: left;
      margin-bottom: 10px;
      font-size: 13px;
    }

    .benefit-item-title { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
    .benefit-item-text { font-size: 13px; color: var(--text-muted); }

    footer {
      margin-top: 22px;
      padding-top: 18px;
      border-top: 1px solid var(--border-soft);
      display: flex;
      justify-content: space-between;
      gap: 18px;
      flex-wrap: wrap;
      font-size: 13px;
      color: var(--text-muted);
    }

    .footer-brand { max-width: 260px; }
    .footer-title { font-weight: 600; color: var(--text-main); margin-bottom: 4px; }

    .footer-columns { display: flex; gap: 28px; flex-wrap: wrap; }
    .footer-col-title { font-weight: 500; margin-bottom: 6px; color: var(--text-main); }
    .footer-link { display: block; margin-bottom: 4px; cursor: pointer; }
    .footer-link:hover { color: var(--text-main); }

    .panel-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.35);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 40;
    }

    .panel {
      background: #ffffff;
      border-radius: 18px;
      width: 90%;
      max-width: 520px;
      max-height: 80vh;
      padding: 20px 22px;
      box-shadow: var(--shadow-strong);
      overflow-y: auto;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .panel-title { font-size: 17px; font-weight: 600; }
    .panel-close { border: none; background: transparent; font-size: 18px; cursor: pointer; color: #6b7280; }

    .login-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 8px;
    }

    .login-form label { font-size: 13px; font-weight: 500; }
    .login-form input {
      width: 100%; margin-top: 4px; padding: 8px 10px;
      border-radius: 10px; border: 1px solid #d1d5db; font-size: 14px;
    }

    .btn-login {
      margin-top: 6px; padding: 9px 14px; border-radius: 999px;
      border: none; background: var(--primary); color: #ffffff;
      font-size: 14px; font-weight: 500; cursor: pointer;
    }

    .status-message { font-size: 13px; margin-top: 8px; }
    .status-message.error { color: #b91c1c; }
    .status-message.success { color: #15803d; }

    @media (max-width: 900px) {
      header { flex-wrap: wrap; gap: 10px; }
      .header-center { order: 3; width: 100%; justify-content: center; flex-wrap: wrap; }
      .products-grid, .categories-grid, .benefits-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }

    @media (max-width: 640px) {
      body { padding: 16px 8px; }
      .page-shell { border-radius: 18px; }
      main { padding: 0 16px 20px 16px; }
      .hero { padding: 22px 18px 20px 18px; }
      .hero-title { font-size: 24px; }
      .products-grid, .categories-grid, .benefits-grid { grid-template-columns: 1fr; }
      header { padding: 14px 18px; }
    }
  </style>
</head>
<body>
  <div class="page-shell">
    <header>
      <div class="header-left">
        <!-- Logo SVG embutido -->
        <svg class="logo-svg" viewBox="0 0 260 70" xmlns="http://www.w3.org/2000/svg">
          <path d="M10 45 L95 45 L95 20 L40 20 L30 10 L10 10 Z" fill="#000000"/>
          <rect x="55" y="16" width="22" height="16" fill="#ffffff"/>
          <path d="M10 45 L95 45 L95 55 L10 55 Z" fill="#000000"/>
          <g fill="#ffffff">
            <polygon points="12,55 16,55 14,60"/>
            <polygon points="18,55 22,55 20,60"/>
            <polygon points="24,55 28,55 26,60"/>
            <polygon points="30,55 34,55 32,60"/>
            <polygon points="36,55 40,55 38,60"/>
            <polygon points="42,55 46,55 44,60"/>
            <polygon points="48,55 52,55 50,60"/>
            <polygon points="54,55 58,55 56,60"/>
            <polygon points="60,55 64,55 62,60"/>
            <polygon points="66,55 70,55 68,60"/>
            <polygon points="72,55 76,55 74,60"/>
            <polygon points="78,55 82,55 80,60"/>
            <polygon points="84,55 88,55 86,60"/>
            <polygon points="90,55 94,55 92,60"/>
          </g>
          <text x="110" y="40" font-family="Inter, system-ui, sans-serif" font-weight="700" font-size="30" fill="#000000">
            serrota
          </text>
          <g fill="#000000">
            <polygon points="112,52 116,52 114,56"/>
            <polygon points="118,52 122,52 120,56"/>
            <polygon points="124,52 128,52 126,56"/>
            <polygon points="130,52 134,52 132,56"/>
            <polygon points="136,52 140,52 138,56"/>
            <polygon points="142,52 146,52 144,56"/>
            <polygon points="148,52 152,52 150,56"/>
            <polygon points="154,52 158,52 156,56"/>
            <polygon points="160,52 164,52 162,56"/>
            <polygon points="166,52 170,52 168,56"/>
            <polygon points="172,52 176,52 174,56"/>
            <polygon points="178,52 182,52 180,56"/>
            <polygon points="184,52 188,52 186,56"/>
            <polygon points="190,52 194,52 192,56"/>
            <polygon points="196,52 200,52 198,56"/>
            <polygon points="202,52 206,52 204,56"/>
            <polygon points="208,52 212,52 210,56"/>
            <polygon points="214,52 218,52 216,56"/>
            <polygon points="220,52 224,52 222,56"/>
            <polygon points="226,52 230,52 228,56"/>
            <polygon points="232,52 236,52 234,56"/>
            <polygon points="238,52 242,52 240,56"/>
          </g>
        </svg>
      </div>

      <nav class="header-center"></nav>

      <div class="header-right">
        <button class="icon-btn" onclick="openPanel('mensagens')" title="Mensagens">
          <i class="fa-regular fa-message"></i>
        </button>
        <button class="icon-btn" onclick="openPanel('notificacoes')" title="Notificacoes">
          <i class="fa-regular fa-bell"></i>
        </button>
        <button class="icon-btn" onclick="openPanel('carrinho')" title="Carrinho">
          <i class="fa-solid fa-cart-shopping"></i>
        </button>
        <div class="account-label" onclick="openPanel('conta')" title="Minha conta">
          <div class="icon-btn" style="width: 30px; height: 30px;">
            <i class="fa-regular fa-user"></i>
          </div>
          <span id="accountLabelText">Minha conta</span>
        </div>
      </div>
    </header>

    <main>
      <section class="hero">
        <div class="hero-content">
          <div class="hero-kicker">Produtos digitais premium</div>
          <h1 class="hero-title">Eleve seus projetos com a Serrota</h1>
          <p class="hero-subtitle">
            E-books, cursos, templates e ferramentas online com acesso imediato. Estoque em tempo real,
            pagamento por Pix e entregas sem espera.
          </p>
          <div class="hero-actions">
            <button class="btn-primary" onclick="scrollToFeatured()">Ver produtos em destaque</button>
            <button class="btn-secondary" onclick="openPanel('compras')">Ver minhas compras</button>
          </div>
        </div>
      </section>

      <section class="section" id="featured-section">
        <div class="section-header">
          <div>
            <h2 class="section-title">Produtos em destaque</h2>
            <p class="section-subtitle">Selecionados para turbinar seus projetos digitais.</p>
          </div>
          <button class="btn-ghost" onclick="setActiveCategory('todos')">Ver todos os produtos</button>
        </div>
        <div class="products-grid" id="featured-products"></div>
      </section>

      <section class="section">
        <div class="section-header">
          <div>
            <h2 class="section-title">Comprar por categoria</h2>
            <p class="section-subtitle">Encontre o tipo de produto ideal para seu momento.</p>
          </div>
        </div>
        <div class="categories-grid" id="categories-grid">
        </div>
      </section>

      <section class="benefits">
        <h2 class="benefits-title">Experiencia de compra agil com a Serrota</h2>
        <p class="benefits-subtitle">
          Pague por Pix via Mercado Pago, receba a confirmacao automatica e acesse seus arquivos digitais em poucos instantes.
        </p>
        <div class="benefits-grid">
          <div>
            <div class="benefit-item-title"><i class="fa-solid fa-bolt"></i> Entrega imediata</div>
            <p class="benefit-item-text">
              Assim que o pagamento for aprovado, o acesso e liberado na sua conta.
            </p>
          </div>
          <div>
            <div class="benefit-item-title"><i class="fa-solid fa-qrcode"></i> Pix via Mercado Pago</div>
            <p class="benefit-item-text">
              Integracao pronta para gerar QR Code e acompanhar o status em tempo real.
            </p>
          </div>
          <div>
            <div class="benefit-item-title"><i class="fa-solid fa-user-shield"></i> Conta segura</div>
            <p class="benefit-item-text">
              Login, sessao e estoque controlados pelo Supabase.
            </p>
          </div>
        </div>
        <button class="btn-primary" onclick="setActiveCategory('todos')">Comecar a comprar</button>
      </section>

      <footer>
        <div class="footer-brand">
          <div class="footer-title">Serrota - Ferramentas digitais afiadas</div>
          <p>
            E-commerce focado em produtos digitais de alta qualidade, pensado para quem quer executar com precisao.
          </p>
        </div>
        <div class="footer-columns">
          <div>
            <div class="footer-col-title">Navegacao</div>
            <span class="footer-link" onclick="setActiveCategory('todos')">Categorias</span>
            <span class="footer-link" onclick="openPanel('compras')">Meus pedidos</span>
            <span class="footer-link" onclick="openPanel('conta')">Minha conta</span>
          </div>
          <div>
            <div class="footer-col-title">Suporte</div>
            <span class="footer-link" onclick="openPanel('mensagens')">Mensagens</span>
            <span class="footer-link">E-mail: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="691a1c19061b1d0c291a0c1b1b061d08470d000e001d0805">[email&#160;protected]</a></span>
          </div>
        </div>
      </footer>
    </main>
  </div>

  <div class="panel-overlay" id="panelOverlay">
    <div class="panel" id="panelContent"></div>
  </div>

  <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
    const SUPABASE_URL = "https://tgtphaevkztzgekfhquu.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRndHBoYWV2a3p0emdla2ZocXV1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwMjg4NjksImV4cCI6MjA4NzYwNDg2OX0.41aby7i4wEllirV3HJTcsgTOzNtc76oca07VZ7qzlFo";

let supabaseClient = null;
if (window.supabase && SUPABASE_URL && SUPABASE_ANON_KEY) {
  supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
}

    const state = {
      products: [],
      filteredCategory: "todos",
      cart: [],
      session: null
    };

    async function loadProducts() {
      const featuredContainer = document.getElementById("featured-products");
      featuredContainer.innerHTML = "<p style='font-size:13px;color:#6b7280;'>Carregando produtos...</p>";

      try {
        if (!supabaseClient) {
          state.products = [
            { id: 1, name: "Pack de Templates Notion", price: 79.9, category: "Templates", image_url: "", stock: 999 },
            { id: 2, name: "Curso Completo de Automacao", price: 249.9, category: "Cursos", image_url: "", stock: 250 },
            { id: 3, name: "E-book Serrota de Produtividade", price: 59.9, category: "E-books", image_url: "", stock: 999 }
          ];
        } else {
          const { data, error } = await supabaseClient
            .from("products")
            .select("*")
            .order("is_featured", { ascending: false });

          if (error) throw error;
          state.products = data || [];
        }
      } catch (e) {
        console.error(e);
        featuredContainer.innerHTML =
          "<p style='font-size:13px;color:#b91c1c;'>Erro ao carregar produtos. Verifique a configuracao do Supabase.</p>";
        return;
      }

      renderProducts();
      renderCategoryCards();
    }

    function renderProducts() {
      const container = document.getElementById("featured-products");
      container.innerHTML = "";

      const list = state.products.filter(p => {
        if (state.filteredCategory === "todos") return true;
        return p.category === state.filteredCategory;
      });

      if (!list.length) {
        container.innerHTML =
          "<p style='font-size:13px;color:#6b7280;'>Nenhum produto encontrado para esta categoria.</p>";
        return;
      }

      list.forEach(product => {
        const card = document.createElement("article");
        card.className = "product-card";

        const imgDiv = document.createElement("div");
        imgDiv.className = "product-image";

        if (product.image_url) {
          const img = document.createElement("img");
          img.src = product.image_url;
          img.alt = product.name;
          imgDiv.appendChild(img);
        } else {
          imgDiv.innerHTML =
            "<i class='fa-solid fa-screwdriver-wrench' style='font-size:36px;color:#1d4ed8;'></i>";
        }

        const cat = document.createElement("div");
        cat.className = "product-category";
        cat.textContent = product.category || "Digital";

        const name = document.createElement("div");
        name.className = "product-name";
        name.textContent = product.name;

        const description = document.createElement("div");
        description.className = "product-description";
        description.textContent = product.description || "";

        const price = document.createElement("div");
        price.className = "product-price";
        price.textContent = "R$ " + (product.price || 0).toFixed(2).replace(".", ",");

        const metaRow = document.createElement("div");
        metaRow.className = "product-meta-row";

        const hasStock = product.stock == null || product.stock > 0;

        if (product.instant_delivery) {
          const badge = document.createElement("div");
          badge.className = "product-badge";
          badge.textContent = "Entrega imediata";
          metaRow.appendChild(badge);
        }

        const stock = document.createElement("div");
        stock.className = "stock-label";
        stock.textContent =
          product.stock != null ? "Estoque: " + product.stock : "Estoque em tempo real";

        metaRow.appendChild(stock);

        const btn = document.createElement("button");
        btn.className = "btn-add-cart";

        if (hasStock) {
          btn.innerHTML = "<i class='fa-solid fa-cart-plus'></i><span>Adicionar ao carrinho</span>";
          btn.onclick = function () { addToCart(product); };
        } else {
          btn.classList.add("disabled");
          btn.disabled = true;
          btn.innerHTML = "<span>Indisponivel</span>";
        }

        card.appendChild(imgDiv);
        card.appendChild(cat);
        card.appendChild(name);
        card.appendChild(description);
        card.appendChild(price);
        card.appendChild(metaRow);
        card.appendChild(btn);

        container.appendChild(card);
      });
    }

    function renderCategoryCards() {
      var container = document.getElementById("categories-grid");
      if (!container) return;

      container.innerHTML = "";

      var seen = {};
      for (var i = 0; i < state.products.length; i++) {
        var cat = state.products[i].category;
        if (!cat) continue;
        if (seen[cat]) continue;
        seen[cat] = true;

        var card = document.createElement("div");
        card.className = "category-card";

        var top = document.createElement("div");

        var nameDiv = document.createElement("div");
        nameDiv.className = "category-name";
        nameDiv.textContent = cat;

        var descDiv = document.createElement("div");
        descDiv.className = "category-description";
        descDiv.textContent = "Veja os produtos da categoria " + cat + ".";

        top.appendChild(nameDiv);
        top.appendChild(descDiv);

        var linkDiv = document.createElement("div");
        linkDiv.className = "category-link";
        linkDiv.textContent = "Ver " + cat.toLowerCase() + " ->";
        linkDiv.onclick = (function (catName) {
          return function () { setActiveCategory(catName); };
        })(cat);

        card.appendChild(top);
        card.appendChild(linkDiv);
        container.appendChild(card);
      }
    }

    function setActiveCategory(category) {
      state.filteredCategory = category;
      var buttons = document.querySelectorAll(".header-center button");
      for (var i = 0; i < buttons.length; i++) {
        var btn = buttons[i];
        btn.classList.toggle("active", btn.getAttribute("data-category") === category);
      }
      renderProducts();
      scrollToFeatured();
    }

    function scrollToFeatured() {
      var section = document.getElementById("featured-section");
      if (section && section.scrollIntoView) {
        section.scrollIntoView({ behavior: "smooth" });
      }
    }

    function addToCart(product) {
      var exists = null;
      for (var i = 0; i < state.cart.length; i++) {
        if (state.cart[i].product.id === product.id) {
          exists = state.cart[i];
          break;
        }
      }
      if (exists) {
        exists.quantity += 1;
      } else {
        state.cart.push({ product: product, quantity: 1 });
      }
      openPanel("carrinho");
    }

    function renderCartPanel() {
      var panel = document.getElementById("panelContent");
      if (!state.cart.length) {
        panel.innerHTML =
          "<div class='panel-header'><h3 class='panel-title'>Carrinho de compras</h3><button class='panel-close' onclick='closePanel()'>&times;</button></div>" +
          "<p style='font-size:13px;color:#6b7280;'>Seu carrinho esta vazio.</p>";
        return;
      }

      var itemsHtml = "";
      var total = 0;
      for (var i = 0; i < state.cart.length; i++) {
        var item = state.cart[i];
        var lineTotal = item.product.price * item.quantity;
        total += lineTotal;
        itemsHtml +=
          "<div style='display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;font-size:13px;'>" +
            "<div>" +
              "<div style='font-weight:500;'>" + item.product.name + "</div>" +
              "<div style='color:#6b7280;'>Qtd: " + item.quantity + "</div>" +
            "</div>" +
            "<div style='display:flex;align-items:center;gap:6px;'>" +
              "<button style='width:24px;height:24px;border-radius:999px;border:1px solid #d1d5db;background:#f9fafb;cursor:pointer;' onclick='changeCartQty(" + i + ",-1)'>-</button>" +
              "<span>" + item.quantity + "</span>" +
              "<button style='width:24px;height:24px;border-radius:999px;border:1px solid #d1d5db;background:#f9fafb;cursor:pointer;' onclick='changeCartQty(" + i + ",1)'>+</button>" +
              "<div style='font-weight:600;color:#1d4ed8;margin-left:8px;'>R$ " +
                lineTotal.toFixed(2).replace('.', ',') +
              "</div>" +
            "</div>" +
          "</div>";
      }

      panel.innerHTML =
        "<div class='panel-header'><h3 class='panel-title'>Carrinho de compras</h3><button class='panel-close' onclick='closePanel()'>&times;</button></div>" +
        "<div>" + itemsHtml + "</div>" +
        "<hr style='border:none;border-top:1px solid #e5e7eb;margin:10px 0;' />" +
        "<div style='display:flex;justify-content:space-between;align-items:center;font-size:14px;margin-bottom:10px;'>" +
        "<span>Total</span><strong>R$ " + total.toFixed(2).replace('.', ',') + "</strong></div>" +
        "<button class='btn-primary' style='width:100%;' onclick='payWithPix()'>Finalizar com Pix (Mercado Pago)</button>" +
        "<p style='font-size:11px;color:#6b7280;margin-top:6px;'>O pagamento e processado via Mercado Pago. Depois da confirmacao, voce recebe acesso imediato.</p>";
    }

    function changeCartQty(index, delta) {
      var item = state.cart[index];
      if (!item) return;
      item.quantity += delta;
      if (item.quantity <= 0) {
        state.cart.splice(index, 1);
      }
      renderCartPanel();
    }

    function payWithPix() {
      alert("Aqui voce integra com seu backend ou Edge Function do Supabase para criar a preferencia Pix no Mercado Pago.");
    }

    async function checkSession() {
      if (!supabaseClient) return;
      var result = await supabaseClient.auth.getSession();
      state.session = result.data.session;
      updateAccountLabel();
    }

    function updateAccountLabel() {
      var label = document.getElementById("accountLabelText");
      if (state.session && state.session.user) {
        label.textContent = "Minha conta";
      } else {
        label.textContent = "Entrar / criar conta";
      }
    }

    async function handleLogin(event) {
      event.preventDefault();
      var email = document.getElementById("loginEmail").value;
      var password = document.getElementById("loginPassword").value;
      var status = document.getElementById("loginStatus");
      status.textContent = "Entrando...";
      status.className = "status-message";

      try {
        if (!supabaseClient) { throw new Error("Supabase nao configurado."); }
        var response = await supabaseClient.auth.signInWithPassword({ email: email, password: password });
        if (response.error) { throw response.error; }
        state.session = response.data.session;
        status.textContent = "Login realizado com sucesso.";
        status.className = "status-message success";
        updateAccountLabel();
      } catch (e) {
        status.textContent = e.message || "Erro ao fazer login.";
        status.className = "status-message error";
      }
    }

    async function loginWithGoogle() {
      if (!supabaseClient) {
        alert("Supabase nao configurado.");
        return;
      }
      try {
        var resp = await supabaseClient.auth.signInWithOAuth({
          provider: "google",
          options: { redirectTo: window.location.origin }
        });
        if (resp.error) { throw resp.error; }
      } catch (e) {
        alert(e.message || "Erro ao iniciar login com Google.");
      }
    }

    async function handleSignup(event) {
      event.preventDefault();
      var email = document.getElementById("signupEmail").value;
      var password = document.getElementById("signupPassword").value;
      var status = document.getElementById("signupStatus");
      status.textContent = "Criando conta...";
      status.className = "status-message";

      try {
        if (!supabaseClient) { throw new Error("Supabase nao configurado."); }
        var resp = await supabaseClient.auth.signUp({
          email: email,
          password: password,
          options: { emailRedirectTo: window.location.origin }
        });
        if (resp.error) { throw resp.error; }
        status.textContent = "Conta criada. Verifique seu email para confirmar o cadastro.";
        status.className = "status-message success";
      } catch (e) {
        status.textContent = e.message || "Erro ao criar conta.";
        status.className = "status-message error";
      }
    }

    async function handleSendResetEmail() {
      var status = document.getElementById("resetStatus");
      status.textContent = "Enviando email...";
      status.className = "status-message";

      try {
        if (!supabaseClient) { throw new Error("Supabase nao configurado."); }
        if (!state.session || !state.session.user) {
          throw new Error("Voce precisa estar logado para trocar a senha.");
        }
        var email = state.session.user.email;
        var resp = await supabaseClient.auth.resetPasswordForEmail(email, {
          redirectTo: window.location.origin + "#senha-atualizada"
        });
        if (resp.error) { throw resp.error; }
        status.textContent = "Email enviado. Acesse o link recebido para definir a nova senha.";
        status.className = "status-message success";
      } catch (e) {
        status.textContent = e.message || "Erro ao enviar email.";
        status.className = "status-message error";
      }
    }

    async function logout() {
      if (!supabaseClient) return;
      await supabaseClient.auth.signOut();
      state.session = null;
      updateAccountLabel();
      renderAccountPanel();
    }

    function renderAccountPanel() {
      var panel = document.getElementById("panelContent");

      if (state.session && state.session.user) {
        panel.innerHTML =
          "<div class='panel-header'><h3 class='panel-title'>Minha conta</h3><button class='panel-close' onclick='closePanel()'>&times;</button></div>" +
          "<p style='font-size:13px;color:#6b7280;margin-bottom:8px;'>Logado como <strong>" + state.session.user.email + "</strong></p>" +
          "<button class='btn-ghost' style='margin-bottom:14px;' onclick='logout()'>Sair</button>" +
          "<hr style='border:none;border-top:1px solid #e5e7eb;margin:10px 0 14px 0;' />" +
          "<h4 style='font-size:14px;font-weight:600;margin-bottom:6px;'>Trocar senha</h4>" +
          "<p style='font-size:13px;color:#6b7280;margin-bottom:8px;'>Enviaremos um email para <strong>" + state.session.user.email + "</strong> com link para redefinir sua senha.</p>" +
          "<button class='btn-login' type='button' onclick='handleSendResetEmail()'>Enviar email para trocar senha</button>" +
          "<div id='resetStatus' class='status-message'></div>";
        return;
      }

      panel.innerHTML =
        "<div class='panel-header'><h3 class='panel-title'>Minha conta</h3><button class='panel-close' onclick='closePanel()'>&times;</button></div>" +
        "<div style='display:flex;gap:8px;margin-bottom:12px;'>" +
        "<button id='tabLogin' class='btn-ghost' style='flex:1;'>Entrar</button>" +
        "<button id='tabSignup' class='btn-ghost' style='flex:1;'>Criar conta</button></div>" +
        "<div id='loginSection'>" +
        "<form class='login-form' onsubmit='handleLogin(event)'>" +
        "<div><label>E-mail</label><input type='email' id='loginEmail' required /></div>" +
        "<div><label>Senha</label><input type='password' id='loginPassword' required /></div>" +
        "<button class='btn-login' type='submit'>Entrar</button>" +
        "<div id='loginStatus' class='status-message'></div></form>" +
        "<div style='margin-top:12px;text-align:center;'><span style='font-size:12px;color:#6b7280;'>ou</span></div>" +
        "<button type='button' onclick='loginWithGoogle()' " +
        "style='margin-top:10px;width:100%;padding:9px 14px;border-radius:999px;border:1px solid #d1d5db;background:#ffffff;font-size:14px;font-weight:500;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;'>" +
        "<i class='fa-brands fa-google'></i><span>Entrar com Google</span></button></div>" +
        "<div id='signupSection' style='display:none;margin-top:4px;'>" +
        "<form class='login-form' onsubmit='handleSignup(event)'>" +
        "<div><label>E-mail</label><input type='email' id='signupEmail' required /></div>" +
        "<div><label>Senha</label><input type='password' id='signupPassword' required /></div>" +
        "<button class='btn-login' type='submit'>Criar conta</button>" +
        "<p style='font-size:11px;color:#6b7280;margin-top:4px;'>Voce recebera um email com link para confirmar seu cadastro.</p>" +
        "<div id='signupStatus' class='status-message'></div></form></div>";

      var tabLogin = panel.querySelector("#tabLogin");
      var tabSignup = panel.querySelector("#tabSignup");
      var loginSection = panel.querySelector("#loginSection");
      var signupSection = panel.querySelector("#signupSection");

      function activate(tab) {
        if (tab === "login") {
          loginSection.style.display = "block";
          signupSection.style.display = "none";
          tabLogin.style.background = "#e5edff";
          tabSignup.style.background = "#f9fafb";
        } else {
          loginSection.style.display = "none";
          signupSection.style.display = "block";
          tabSignup.style.background = "#e5edff";
          tabLogin.style.background = "#f9fafb";
        }
      }

      tabLogin.onclick = function () { activate("login"); };
      tabSignup.onclick = function () { activate("signup"); };
      activate("login");
    }

    function renderMessagesPanel() {
      var panel = document.getElementById("panelContent");
      panel.innerHTML =
        "<div class='panel-header'><h3 class='panel-title'>Mensagens</h3><button class='panel-close' onclick='closePanel()'>&times;</button></div>" +
        "<p style='font-size:13px;color:#6b7280;'>Central para contato e suporte. Integre com uma tabela \"messages\" no Supabase.</p>";
    }

    function renderPurchasesPanel() {
      var panel = document.getElementById("panelContent");
      panel.innerHTML =
        "<div class='panel-header'><h3 class='panel-title'>Minhas compras</h3><button class='panel-close' onclick='closePanel()'>&times;</button></div>" +
        "<p style='font-size:13px;color:#6b7280;'>Liste aqui os pedidos a partir da tabela \"purchases\" do Supabase.</p>";
    }

    function renderNotificationsPanel() {
      var panel = document.getElementById("panelContent");
      panel.innerHTML =
        "<div class='panel-header'><h3 class='panel-title'>Notificacoes</h3><button class='panel-close' onclick='closePanel()'>&times;</button></div>" +
        "<p style='font-size:13px;color:#6b7280;'>Area para avisos de pagamento, atualizacoes de pedidos e novidades.</p>";
    }

    function openPanel(type) {
      var overlay = document.getElementById("panelOverlay");
      overlay.style.display = "flex";

      if (type === "carrinho") renderCartPanel();
      else if (type === "conta") renderAccountPanel();
      else if (type === "mensagens") renderMessagesPanel();
      else if (type === "compras") renderPurchasesPanel();
      else if (type === "notificacoes") renderNotificationsPanel();
    }

    function closePanel() {
      document.getElementById("panelOverlay").style.display = "none";
    }

    document.getElementById("panelOverlay").addEventLis